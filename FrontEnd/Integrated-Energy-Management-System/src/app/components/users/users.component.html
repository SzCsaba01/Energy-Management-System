<div class="users-container">
    <div  class="add-user-btn">
        <button class="btn btn-secondary" (click)="changeShowAddUserModal()">Add User</button>
    </div>
    <div class="clickable mat-elevation-z8">
        <table mat-table  matSort [dataSource]="dataSource" class="mat-elevation-z8">
            <ng-container matColumnDef="username">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 
                Username</th>
            <td mat-cell *matCellDef="let element"> {{element.username}} </td>
            </ng-container>
            <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 
                Email</th>
            <td mat-cell *matCellDef="let element"> {{element.email}} </td>
            </ng-container>
            <ng-container matColumnDef="firstName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> First name </th>
            <td mat-cell *matCellDef="let element"> {{element.firstName}} </td>
            </ng-container>
            <ng-container matColumnDef="lastName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 
                Last Name</th>
            <td mat-cell *matCellDef="let element"> {{element.lastName}} </td>
            </ng-container>
            <ng-container matColumnDef="role">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> 
                    Role</th>
                <td mat-cell *matCellDef="let element"> {{element.role}} </td>
                </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedUserColumns"></tr>
            <tr mat-row (click)="onRowClicked(row)" *matRowDef="let row; columns: displayedUserColumns;"></tr>
        </table>

        <mat-paginator [pageSizeOptions]="[5, 10]"showFirstLastButtons>
        </mat-paginator>
    </div>
</div>

<div class="modal" *ngIf="isAddUserModalShown" [ngStyle]="{'display':'block'}">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="exampleModalLongTitle">Edit product</h4>
          <i (click)="changeShowAddUserModal()" class="close bi bi-x-circle clickable cancel-button-modals"></i>
        </div>
        <div class="modal-body">
        <form [formGroup]="addUserFG" novalidate>
            <div class="form-group">
            <label>Username</label>
            <input 
            type="text" 
            class="form-control" 
            formControlName="username" 
            [ngClass]="{'is-invalid': addUsernameFC.errors && (addUsernameFC.touched || addUsernameFC.dirty), 'is-valid':addUsernameFC.valid}">
                <div class="invalid-feedback" >
                    <strong *ngIf="addUsernameFC.errors?.['required']">Username is required</strong>
                    <strong *ngIf="addUsernameFC.errors?.['minLength']"> Username must contain atleast 5 characters</strong>
                    <strong *ngIf="addUsernameFC.errors?.['maxLength']"> Username must contain maximum 50 characters</strong>
                </div>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="email" 
                  [ngClass]="{'is-invalid': addEmailFC.errors && (addEmailFC.touched || addEmailFC.dirty), 'is-valid':addEmailFC.valid}">
                <div class="invalid-feedback" >
                    <strong *ngIf="addEmailFC.errors?.['email']">That's not a valid Email!</strong>
                    <strong *ngIf="addEmailFC.errors?.['required']">Email is required</strong>
                    <strong *ngIf="addEmailFC.errors?.['minLength']"> Email must contain atleast 5 characters</strong>
                    <strong *ngIf="addEmailFC.errors?.['maxLength']"> Email must contain maximum 50 characters</strong>
                </div>
            </div>
            <div class="form-group">
                <label>First Name</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="firstName" 
                  [ngClass]="{'is-invalid': addFirstNameFC.errors && (addFirstNameFC.touched || addFirstNameFC.dirty), 'is-valid':addFirstNameFC.valid}">
                <div class="invalid-feedback" >
                    <strong *ngIf="addFirstNameFC.errors?.['required']">First Name is required</strong>
                    <strong *ngIf="addFirstNameFC.errors?.['minLength']"> First Name must contain atleast 5 characters</strong>
                    <strong *ngIf="addFirstNameFC.errors?.['maxLength']"> First name must contain maximum 50 characters</strong>
                </div>
            </div>
            <div class="form-group">
                <label>Last Name</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="lastName" 
                  [ngClass]="{'is-invalid': addLastNameFC.errors && 
                            (addLastNameFC.touched || addLastNameFC.dirty), 
                            'is-valid':addLastNameFC.valid}">
                <div class="invalid-feedback" >
                    <strong *ngIf="addLastNameFC.errors?.['required']">
                        Last Name is required</strong>
                    <strong *ngIf="addLastNameFC.errors?.['minLength']"> 
                        Last Name must be atleast 5 characters</strong>
                    <strong *ngIf="addLastNameFC.errors?.['maxLength']"> 
                        Last Name must be maximum 50 characters</strong>
                </div>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input 
                  type="password" 
                  class="form-control" 
                  formControlName="password" 
                  [ngClass]="{'is-invalid': addPasswordFC.errors && 
                            (addPasswordFC.touched || addPasswordFC.dirty), 
                            'is-valid':addPasswordFC.valid}">
                <div class="invalid-feedback" >
                    <strong *ngIf="addPasswordFC.errors?.['required']">
                        Password is required</strong>
                    <strong *ngIf="addPasswordFC.errors?.['minLength']"> 
                        Password must be atleast 5 characters</strong>
                    <strong *ngIf="addPasswordFC.errors?.['maxLength']"> 
                        Password must be maximum 50 characters</strong>
                    <strong *ngIf="addPasswordFC.errors?.['pattern']">
                        Password must contain atleast one lowercase, uppercase, number and special character
                    </strong>
                </div>
            </div>
            <div class="from-group">
                <label>Role</label>
                <input 
                    type="text" 
                    class="form-control" 
                    formControlName="role"
                    [readOnly]="true">
            </div>
          </form>
        </div>
        <div class="modal-footer">
            <button type="submit" [disabled]="addUserFG.invalid" (click)="onAddUser(addUserFG.value)" class="btn btn-primary">Submit</button>
        </div>
      </div>
    </div>
  </div>
  
<div class="modal" *ngIf="isEditUserModalShown" [ngStyle]="{'display':'block'}">
    <div class="modal-dialog">
        <div class="modal-content" *ngIf="!isEditUserDevicesShown">
            <div class="modal-header">
            <h4 class="modal-title" id="exampleModalLongTitle">Edit User</h4>
            <i (click)="exitEditUser()" class="close bi bi-x-circle clickable cancel-button-modals"></i>
            </div>
            <div class="modal-body">
                <form [formGroup]="editUserFG" novalidate>
                    <div class="form-group">
                    <label>Username</label>
                    <input 
                    type="text" 
                    class="form-control" 
                    formControlName="username" 
                    [readOnly]="true">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            formControlName="email" 
                            [ngClass]="{'is-invalid': editEmailFC.errors && (editEmailFC.touched || editEmailFC.dirty), 'is-valid':editEmailFC.valid}">
                        <div class="invalid-feedback" >
                            <strong *ngIf="editEmailFC.errors?.['email']">That's not a valid Email!</strong>
                            <strong *ngIf="editEmailFC.errors?.['required']">Email is required</strong>
                            <strong *ngIf="editEmailFC.errors?.['minLength']"> Email must contain atleast 5 characters</strong>
                            <strong *ngIf="editEmailFC.errors?.['maxLength']"> Email must contain maximum 50 characters</strong>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>First Name</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            formControlName="firstName" 
                            [ngClass]="{'is-invalid': editFirstNameFC.errors && (editFirstNameFC.touched || editFirstNameFC.dirty), 'is-valid':editFirstNameFC.valid}">
                        <div class="invalid-feedback" >
                            <strong *ngIf="editFirstNameFC.errors?.['required']">First Name is required</strong>
                            <strong *ngIf="editFirstNameFC.errors?.['minLength']"> First Name must contain atleast 5 characters</strong>
                            <strong *ngIf="editFirstNameFC.errors?.['maxLength']"> First name must contain maximum 50 characters</strong>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            formControlName="lastName" 
                            [ngClass]="{'is-invalid': editLastNameFC.errors && 
                                    (editLastNameFC.touched || editLastNameFC.dirty), 
                                    'is-valid':editLastNameFC.valid}">
                        <div class="invalid-feedback" >
                            <strong *ngIf="editLastNameFC.errors?.['required']">
                                Last Name is required</strong>
                            <strong *ngIf="editLastNameFC.errors?.['minLength']"> 
                                Last Name must be atleast 5 characters</strong>
                            <strong *ngIf="editLastNameFC.errors?.['maxLength']"> 
                                Last Name must be maximum 50 characters</strong>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input 
                            type="password" 
                            class="form-control" 
                            formControlName="password" 
                            [ngClass]="{'is-invalid': editPasswordFC.errors && 
                                    (editPasswordFC.touched || editPasswordFC.dirty), 
                                    'is-valid':editPasswordFC.valid}">
                        <div class="invalid-feedback" >
                            <strong *ngIf="editPasswordFC.errors?.['required']">
                                Password is required</strong>
                            <strong *ngIf="editPasswordFC.errors?.['minLength']"> 
                                Password must be atleast 5 characters</strong>
                            <strong *ngIf="editPasswordFC.errors?.['maxLength']"> 
                                Password must be maximum 50 characters</strong>
                            <strong *ngIf="editPasswordFC.errors?.['pattern']">
                                Password must contain atleast one lowercase, uppercase, number and special character
                            </strong>
                        </div>
                    </div>
                    <div class="from-group">
                        <label>Role</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            formControlName="role"
                            [readOnly]="true">
                    </div>
                </form>
            </div>
            <div class="modal-footer btn-toolbar justify-content-between">
                <button type="button" (click)="onDeleteSelectedUser()" class="btn btn-danger">Delete</button>
                <div class="right-buttons">
                    <button type="button" (click)="onChangeShowEditUserDevices()" class="btn btn-light">Edit Devices</button>
                    <button type="submit" [disabled]="editUserFG.invalid" (click)="onSaveChanges(editUserFG.value)" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </div>
        <div class="modal-content" *ngIf="isEditUserDevicesShown">
            <div class="modal-header">
            <h4 class="modal-title" id="exampleModalLongTitle">Edit User Devices</h4>
            <i (click)="exitEditUser()" class="close bi bi-x-circle clickable cancel-button-modals"></i>
            </div>
            <div class="modal-body">
                <table mat-table  matSort [dataSource]="dataSourceSelectedUserDevices" class="mat-elevation-z8">
                    <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> 
                        Name </th>
                    <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                    </ng-container>
                    <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> 
                        Description </th>
                    <td mat-cell *matCellDef="let element"> {{element.description}} </td>
                    </ng-container>
                    <ng-container matColumnDef="address">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Address </th>
                    <td mat-cell *matCellDef="let element"> {{element.address}} </td>
                    </ng-container>
                    <ng-container matColumnDef="maxHourlyEnergyConsumption">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> 
                        Max Hourly Energy Consumption </th>
                    <td mat-cell *matCellDef="let element"> {{element.maxHourlyEnergyConsumption}} </td>
                    </ng-container>
                    <ng-container matColumnDef="deleteButton">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let element"> 
                        <mat-icon (click)="onRemoveDeviceFromSelectedUser(element)" class="thrash-icon">delete</mat-icon>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedDeviceColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedDeviceColumns;"></tr>

                </table>
                <mat-paginator [pageSizeOptions]="[5, 10]"showFirstLastButtons>
                </mat-paginator>
                <div class="btn-toolbar justify-content-between select-device">
                    <div class="input-group">
                        <form>
                            <mat-form-field>
                                <mat-label>Unassigned Devices</mat-label>
                                <mat-select [(ngModel)]="selectedDevice" name="device">
                                    <mat-option>None</mat-option>
                                    <mat-option *ngFor="let device of unAssignedDevices" [value]="device">
                                    {{device.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </form>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary assign-btn" (click)="onAssignDeviceToSelectedUser()">Asign Selected Device</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer btn-toolbar justify-content-between">
                <button type="button" (click)="onDeleteSelectedUser()" class="btn btn-danger">Delete</button>
                <div class="right-buttons">
                    <button type="button" (click)="onChangeShowEditUserDevices()" class="btn btn-light">Edit User</button>
                    <button type="submit" [disabled]="editUserFG.invalid" (click)="onSaveChanges(editUserFG.value)" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>